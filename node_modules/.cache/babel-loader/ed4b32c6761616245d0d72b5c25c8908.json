{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.signERC2612Permit = exports.signDaiPermit = void 0;\n\nconst rpc_1 = require(\"./rpc\");\n\nconst lib_1 = require(\"./lib\");\n\nconst MAX_INT = '0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff';\nconst EIP712Domain = [{\n  name: \"name\",\n  type: \"string\"\n}, {\n  name: \"version\",\n  type: \"string\"\n}, {\n  name: \"chainId\",\n  type: \"uint256\"\n}, {\n  name: \"verifyingContract\",\n  type: \"address\"\n}];\n\nconst createTypedDaiData = (message, domain) => {\n  const typedData = {\n    types: {\n      EIP712Domain,\n      Permit: [{\n        name: \"holder\",\n        type: \"address\"\n      }, {\n        name: \"spender\",\n        type: \"address\"\n      }, {\n        name: \"nonce\",\n        type: \"uint256\"\n      }, {\n        name: \"expiry\",\n        type: \"uint256\"\n      }, {\n        name: \"allowed\",\n        type: \"bool\"\n      }]\n    },\n    primaryType: \"Permit\",\n    domain,\n    message\n  };\n  return typedData;\n};\n\nconst createTypedERC2612Data = (message, domain) => {\n  const typedData = {\n    types: {\n      EIP712Domain,\n      Permit: [{\n        name: \"owner\",\n        type: \"address\"\n      }, {\n        name: \"spender\",\n        type: \"address\"\n      }, {\n        name: \"value\",\n        type: \"uint256\"\n      }, {\n        name: \"nonce\",\n        type: \"uint256\"\n      }, {\n        name: \"deadline\",\n        type: \"uint256\"\n      }]\n    },\n    primaryType: \"Permit\",\n    domain,\n    message\n  };\n  return typedData;\n};\n\nconst NONCES_FN = '0x7ecebe00';\nconst NAME_FN = '0x06fdde03';\n\nconst zeros = numZeros => ''.padEnd(numZeros, '0');\n\nconst getTokenName = (provider, address) => __awaiter(void 0, void 0, void 0, function* () {\n  return lib_1.hexToUtf8((yield rpc_1.call(provider, address, NAME_FN)).substr(130));\n});\n\nconst getDomain = (provider, token) => __awaiter(void 0, void 0, void 0, function* () {\n  if (typeof token !== 'string') {\n    return token;\n  }\n\n  const tokenAddress = token;\n  const [name, chainId] = yield Promise.all([getTokenName(provider, tokenAddress), rpc_1.getChainId(provider)]);\n  const domain = {\n    name,\n    version: '1',\n    chainId,\n    verifyingContract: tokenAddress\n  };\n  return domain;\n});\n\nexports.signDaiPermit = (provider, token, holder, spender, expiry, nonce) => __awaiter(void 0, void 0, void 0, function* () {\n  const tokenAddress = token.verifyingContract || token;\n  const message = {\n    holder,\n    spender,\n    nonce: nonce || (yield rpc_1.call(provider, tokenAddress, `${NONCES_FN}${zeros(24)}${holder.substr(2)}`)),\n    expiry: expiry || MAX_INT,\n    allowed: true\n  };\n  const domain = yield getDomain(provider, token);\n  const typedData = createTypedDaiData(message, domain);\n  const sig = yield rpc_1.signData(provider, holder, typedData);\n  return Object.assign(Object.assign({}, sig), message);\n});\n\nexports.signERC2612Permit = function (provider, token, owner, spender) {\n  let value = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : MAX_INT;\n  let deadline = arguments.length > 5 ? arguments[5] : undefined;\n  let nonce = arguments.length > 6 ? arguments[6] : undefined;\n  return __awaiter(void 0, void 0, void 0, function* () {\n    const tokenAddress = token.verifyingContract || token;\n    const message = {\n      owner,\n      spender,\n      value,\n      nonce: nonce || (yield rpc_1.call(provider, tokenAddress, `${NONCES_FN}${zeros(24)}${owner.substr(2)}`)),\n      deadline: deadline || MAX_INT\n    };\n    const domain = yield getDomain(provider, token);\n    const typedData = createTypedERC2612Data(message, domain);\n    const sig = yield rpc_1.signData(provider, owner, typedData);\n    return Object.assign(Object.assign({}, sig), message);\n  });\n};","map":{"version":3,"sources":["/Users/tanmayjuneja/Documents/demos/SmartDAO/node_modules/eth-permit/dist/eth-permit.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","Object","defineProperty","exports","signERC2612Permit","signDaiPermit","rpc_1","require","lib_1","MAX_INT","EIP712Domain","name","type","createTypedDaiData","message","domain","typedData","types","Permit","primaryType","createTypedERC2612Data","NONCES_FN","NAME_FN","zeros","numZeros","padEnd","getTokenName","provider","address","hexToUtf8","call","substr","getDomain","token","tokenAddress","chainId","all","getChainId","version","verifyingContract","holder","spender","expiry","nonce","allowed","sig","signData","assign","owner","deadline"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.signERC2612Permit = exports.signDaiPermit = void 0;\nconst rpc_1 = require(\"./rpc\");\nconst lib_1 = require(\"./lib\");\nconst MAX_INT = '0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff';\nconst EIP712Domain = [\n    { name: \"name\", type: \"string\" },\n    { name: \"version\", type: \"string\" },\n    { name: \"chainId\", type: \"uint256\" },\n    { name: \"verifyingContract\", type: \"address\" },\n];\nconst createTypedDaiData = (message, domain) => {\n    const typedData = {\n        types: {\n            EIP712Domain,\n            Permit: [\n                { name: \"holder\", type: \"address\" },\n                { name: \"spender\", type: \"address\" },\n                { name: \"nonce\", type: \"uint256\" },\n                { name: \"expiry\", type: \"uint256\" },\n                { name: \"allowed\", type: \"bool\" },\n            ],\n        },\n        primaryType: \"Permit\",\n        domain,\n        message,\n    };\n    return typedData;\n};\nconst createTypedERC2612Data = (message, domain) => {\n    const typedData = {\n        types: {\n            EIP712Domain,\n            Permit: [\n                { name: \"owner\", type: \"address\" },\n                { name: \"spender\", type: \"address\" },\n                { name: \"value\", type: \"uint256\" },\n                { name: \"nonce\", type: \"uint256\" },\n                { name: \"deadline\", type: \"uint256\" },\n            ],\n        },\n        primaryType: \"Permit\",\n        domain,\n        message,\n    };\n    return typedData;\n};\nconst NONCES_FN = '0x7ecebe00';\nconst NAME_FN = '0x06fdde03';\nconst zeros = (numZeros) => ''.padEnd(numZeros, '0');\nconst getTokenName = (provider, address) => __awaiter(void 0, void 0, void 0, function* () { return lib_1.hexToUtf8((yield rpc_1.call(provider, address, NAME_FN)).substr(130)); });\nconst getDomain = (provider, token) => __awaiter(void 0, void 0, void 0, function* () {\n    if (typeof token !== 'string') {\n        return token;\n    }\n    const tokenAddress = token;\n    const [name, chainId] = yield Promise.all([\n        getTokenName(provider, tokenAddress),\n        rpc_1.getChainId(provider),\n    ]);\n    const domain = { name, version: '1', chainId, verifyingContract: tokenAddress };\n    return domain;\n});\nexports.signDaiPermit = (provider, token, holder, spender, expiry, nonce) => __awaiter(void 0, void 0, void 0, function* () {\n    const tokenAddress = token.verifyingContract || token;\n    const message = {\n        holder,\n        spender,\n        nonce: nonce || (yield rpc_1.call(provider, tokenAddress, `${NONCES_FN}${zeros(24)}${holder.substr(2)}`)),\n        expiry: expiry || MAX_INT,\n        allowed: true,\n    };\n    const domain = yield getDomain(provider, token);\n    const typedData = createTypedDaiData(message, domain);\n    const sig = yield rpc_1.signData(provider, holder, typedData);\n    return Object.assign(Object.assign({}, sig), message);\n});\nexports.signERC2612Permit = (provider, token, owner, spender, value = MAX_INT, deadline, nonce) => __awaiter(void 0, void 0, void 0, function* () {\n    const tokenAddress = token.verifyingContract || token;\n    const message = {\n        owner,\n        spender,\n        value,\n        nonce: nonce || (yield rpc_1.call(provider, tokenAddress, `${NONCES_FN}${zeros(24)}${owner.substr(2)}`)),\n        deadline: deadline || MAX_INT,\n    };\n    const domain = yield getDomain(provider, token);\n    const typedData = createTypedERC2612Data(message, domain);\n    const sig = yield rpc_1.signData(provider, owner, typedData);\n    return Object.assign(Object.assign({}, sig), message);\n});\n"]},"metadata":{},"sourceType":"script"}